# 副本记录界面功能优化计划

## 优化目标
对副本记录界面（RaidLogger 组件）进行三项功能优化，同时确保其他界面（RaidManager、RaidDetail 等）的功能不受影响。

---

## 1. 移除"CD已清"复选框功能

### 修改位置
- **文件**: [RaidLogger.tsx](file:///e:/Data/jx3-raid-manager/components/RaidLogger.tsx)

### 具体修改
1. **删除状态定义** (第90行)
   - 移除 `const [isCleared, setIsCleared] = useState(true);`

2. **删除 UI 元素** (第424-433行)
   - 移除整个"CD已清"复选框的 JSX 代码块

3. **删除数据保存逻辑** (第253、254、260、289、298行)
   - 在 `handleAddRecord` 函数中移除 `isCleared` 相关代码
   - 移除提交后的状态重置 `setIsCleared(true)`

4. **删除历史记录显示** (第530-533行)
   - 移除历史记录列表中的 CD 状态图标（CheckCircle2/XCircle）

5. **保留类型定义**
   - 保留 `RaidRecord` 接口中的 `isCleared` 字段，确保向后兼容历史数据
   - 新记录将不再设置该字段

---

## 2. 副本排序优化

### 修改位置
- **文件**: [RaidLogger.tsx](file:///e:/Data/jx3-raid-manager/components/RaidLogger.tsx)
- **当前排序逻辑**: 第74-83行

### 新排序规则
**优先级顺序**：
1. **人数优先**: 25人本 → 10人本
2. **难度次之**（相同人数内）: 挑战 → 英雄 → 普通
3. **资料片排序**: 保持现有的资料片逆序排序（丝路风雨 → 横刀断浪 → ...）
4. **副本名称**: 相同资料片内按名称逆序排列

### 实现方式
修改 `activeRaids` 的排序函数，使用多级排序：
```typescript
const activeRaids = safeRaids.filter(r => r.isActive).sort((a, b) => {
  // 1. 按人数排序（25人优先）
  const playerCountOrder = { 25: 0, 10: 1 };
  if (playerCountOrder[a.playerCount] !== playerCountOrder[b.playerCount]) {
    return playerCountOrder[a.playerCount] - playerCountOrder[b.playerCount];
  }
  
  // 2. 按难度排序（挑战 → 英雄 → 普通）
  const difficultyOrder = { 'CHALLENGE': 0, 'HEROIC': 1, 'NORMAL': 2 };
  if (difficultyOrder[a.difficulty] !== difficultyOrder[b.difficulty]) {
    return difficultyOrder[a.difficulty] - difficultyOrder[b.difficulty];
  }
  
  // 3. 按资料片排序（保持现有逻辑）
  const orderA = a.version ? versionOrderMap[a.version] || 999 : 999;
  const orderB = b.version ? versionOrderMap[b.version] || 999 : 999;
  if (orderA !== orderB) {
    return orderA - orderB;
  }
  
  // 4. 按副本名称逆序排列
  return b.name.localeCompare(a.name);
});
```

### 影响范围
- ✅ **仅影响** RaidLogger 组件的副本下拉框排序
- ✅ **不影响** RaidManager 组件的副本排序（该组件有自己独立的排序逻辑）
- ✅ **不影响** RaidDetail 组件的任何功能

---

## 3. 下拉框显示优化

### 修改位置
- **文件**: [RaidLogger.tsx](file:///e:/Data/jx3-raid-manager/components/RaidLogger.tsx)
- **目标下拉框**: 副本名称下拉框（第393-409行）

### 优化内容
为副本名称下拉框添加样式限制，防止内容过多时超出可视范围：

```tsx
<select 
  className="w-full p-2 border border-slate-300 rounded-lg max-h-60 overflow-y-auto"
  value={selectedRaidKey}
  onChange={e => setSelectedRaidKey(e.target.value)}
>
```

### 实现细节
- 添加 `max-h-60` 类（Tailwind CSS，限制最大高度为 15rem / 240px）
- 添加 `overflow-y-auto` 类（启用垂直滚动条）
- 保持原有的宽度和其他视觉样式不变

### 影响范围
- ✅ **仅影响** RaidLogger 组件的副本名称下拉框
- ✅ **不影响** 角色选择下拉框和筛选器下拉框（它们通常选项较少）
- ✅ **不影响** 其他组件中的任何下拉框

---

## 影响分析

### 受影响的文件
- ✅ **仅修改**: [RaidLogger.tsx](file:///e:/Data/jx3-raid-manager/components/RaidLogger.tsx)

### 不受影响的组件
- ✅ [RaidManager.tsx](file:///e:/Data/jx3-raid-manager/components/RaidManager.tsx) - 副本管理界面，有独立的排序逻辑
- ✅ [RaidDetail.tsx](file:///e:/Data/jx3-raid-manager/components/RaidDetail.tsx) - 副本详情界面
- ✅ [types.ts](file:///e:/Data/jx3-raid-manager/types.ts) - 类型定义（保留 isCleared 字段）
- ✅ 其他所有组件和工具函数

### 数据兼容性
- ✅ 历史记录中的 `isCleared` 字段仍然存在，不会导致数据丢失
- ✅ 新创建的记录将不再包含 `isCleared` 字段
- ✅ 历史记录显示时不再显示 CD 状态图标

---

## 测试要点

1. **CD已清移除测试**
   - 验证表单中不再显示"CD已清"复选框
   - 验证提交记录功能正常
   - 验证历史记录不再显示 CD 状态图标
   - 验证历史数据仍然可以正常加载和显示

2. **副本排序测试**
   - 验证副本下拉框按新规则排序（25人 → 10人，挑战 → 英雄 → 普通）
   - 验证 RaidManager 界面的排序不受影响
   - 验证所有副本选项都能正常选择和提交

3. **下拉框滚动测试**
   - 验证下拉框展开时不会超出可视范围
   - 验证滚动条在内容过多时自动出现
   - 验证滚动操作流畅，所有选项都可访问

4. **回归测试**
   - 验证所有其他功能正常运行
   - 验证角色选择、工资输入、玄晶标记等功能不受影响
   - 验证批量删除、筛选等功能正常