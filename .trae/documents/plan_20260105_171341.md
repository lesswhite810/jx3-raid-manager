# 角色卡片交互功能开发计划

## 概述
在 RaidDetail.tsx 中实现角色卡片点击交互功能，支持快速添加副本记录和查看角色记录详情。

---

## 1. 数据结构扩展

### types.ts
```typescript
// 添加交易类型枚举
export enum TransactionType {
  INCOME = 'income',
  EXPENSE = 'expense'
}

// 扩展 RaidRecord 接口（可选，用于记录支出类型）
export interface RaidRecord {
  // ... 现有字段
  transactionType?: TransactionType; // 默认为收入
}
```

---

## 2. 添加记录弹窗组件 (AddRecordModal.tsx)

### 功能特性
- 弹窗式设计，响应式居中显示
- 自动填充：副本名称、角色名称、当前时间戳
- 交易类型单选：收入 / 支出
- 收入时显示玄晶选择框
- 支出时显示备注输入
- 表单验证和提交处理
- 成功提示动画

### 组件接口
```typescript
interface AddRecordModalProps {
  isOpen: boolean;
  onClose: () => void;
  onSubmit: (record: Partial<RaidRecord>) => void;
  raid: Raid;
  role: RoleWithStatus;
  defaultDate?: string; // 可选，默认为当前时间
}
```

---

## 3. 记录详情弹窗组件 (RoleRecordsModal.tsx)

### 功能特性
- 显示角色所有副本记录（按时间倒序）
- 记录卡片展示：时间、副本名称、金币收入、玄晶标识
- 返回按钮关闭弹窗
- 空状态提示
- 滚动支持（大量记录时）

### 组件接口
```typescript
interface RoleRecordsModalProps {
  isOpen: boolean;
  onClose: () => void;
  role: RoleWithStatus;
  records: RaidRecord[];
}
```

---

## 4. RaidDetail.tsx 修改

### 状态管理
```typescript
// 添加弹窗状态
const [showAddRecordModal, setShowAddRecordModal] = useState(false);
const [showRoleRecordsModal, setShowRoleRecordsModal] = useState(false);
const [selectedRoleForModal, setSelectedRoleForModal] = useState<RoleWithStatus | null>(null);
```

### 角色卡片交互
- 可打状态卡片：点击打开添加记录弹窗
- 已打状态卡片：点击打开记录详情弹窗
- 添加 hover 和 active 状态的视觉反馈（阴影、缩放效果）
- 点击时添加涟漪或高亮动画效果

### 卡片样式优化
```typescript
// 添加可点击样式
className={`p-4 rounded-lg border-2 transition-all cursor-pointer
  ${role.canRun 
    ? 'bg-green-50 border-green-300 hover:shadow-lg hover:border-green-400' 
    : 'bg-orange-50 border-orange-300 hover:shadow-lg hover:border-orange-400'
  } active:scale-95`}
```

---

## 5. 集成新组件

1. **Import 语句**
   ```typescript
   import { AddRecordModal } from './AddRecordModal';
   import { RoleRecordsModal } from './RoleRecordsModal';
   ```

2. **渲染弹窗组件**
   ```tsx
   {showAddRecordModal && selectedRoleForModal && (
     <AddRecordModal
       isOpen={showAddRecordModal}
       onClose={() => setShowAddRecordModal(false)}
       onSubmit={handleAddRecord}
       raid={raid}
       role={selectedRoleForModal}
     />
   )}
   
   {showRoleRecordsModal && selectedRoleForModal && (
     <RoleRecordsModal
       isOpen={showRoleRecordsModal}
       onClose={() => setShowRoleRecordsModal(false)}
       role={selectedRoleForModal}
       records={records}
     />
   )}
   ```

---

## 6. 事件处理函数

### handleAddRecord
- 验证表单数据
- 构建完整记录对象
- 调用父组件传递的 setRecords 更新数据
- 显示成功提示
- 关闭弹窗

### handleCardClick
```typescript
const handleCardClick = (role: RoleWithStatus) => {
  if (role.canRun) {
    // 可打状态：添加记录
    setSelectedRoleForModal(role);
    setShowAddRecordModal(true);
  } else {
    // 已打状态：查看详情
    setSelectedRoleForModal(role);
    setShowRoleRecordsModal(true);
  }
};
```

---

## 7. 用户体验优化

### 动画效果
- 弹窗淡入淡出动画（duration-200）
- 卡片悬停效果（hover:shadow-lg hover:scale-[1.02]）
- 卡片点击效果（active:scale-95）

### 视觉反馈
- 可打卡片：绿色主题
- 已打卡片：橙色主题
- 点击时添加高亮边框效果

### 响应式设计
- 移动端：全宽弹窗
- 桌面端：适中宽度弹窗（max-w-md）

---

## 8. 文件清单

| 文件 | 操作 |
|------|------|
| types.ts | 修改 - 添加 TransactionType 枚举 |
| AddRecordModal.tsx | 新建 - 添加记录弹窗组件 |
| RoleRecordsModal.tsx | 新建 - 记录详情弹窗组件 |
| RaidDetail.tsx | 修改 - 添加交互和集成弹窗 |

---

## 9. 测试验证

1. **添加记录流程**
   - 点击可打角色卡片 → 弹窗显示
   - 自动填充信息正确
   - 选择收入/支出类型
   - 提交后记录添加成功
   - 角色状态更新为已打

2. **查看详情流程**
   - 点击已打角色卡片 → 弹窗显示
   - 显示该角色所有相关记录
   - 记录按时间倒序排列
   - 返回按钮正常工作

3. **数据一致性**
   - 新增记录与 RaidLogger 功能完全一致
   - 记录筛选和统计正常工作